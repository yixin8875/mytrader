# MyTrader 用户手册

MyTrader 是一个专业的交易管理系统，帮助您记录交易、分析绩效、管理风险。

---

## 目录

1. [快速开始](#快速开始)
2. [核心功能](#核心功能)
3. [交易管理](#交易管理)
4. [账户管理](#账户管理)
5. [持仓管理](#持仓管理)
6. [策略管理](#策略管理)
7. [风险管理](#风险管理)
8. [报表分析](#报表分析)
9. [通知系统](#通知系统)
10. [自动化功能](#自动化功能)
11. [数据导入导出](#数据导入导出)
12. [常见问题](#常见问题)

---

## 快速开始

### 启动系统

```bash
# 进入项目目录
cd /path/to/mytrader

# 启动开发服务器
.venv/bin/python manage.py runserver
```

### 访问系统

- 主页：http://127.0.0.1:8000/
- 管理后台：http://127.0.0.1:8000/admin/

### 首次使用

1. 创建管理员账户：
   ```bash
   python manage.py createsuperuser
   ```

2. 登录系统后，按以下顺序设置：
   - 创建交易标的（Symbol）
   - 创建交易账户（Account）
   - 开始记录交易

---

## 核心功能

### 仪表盘

主页仪表盘展示：
- **总资产**：所有账户当前余额总和
- **总盈亏**：相对于初始资金的盈亏
- **账户数量**：活跃账户数
- **胜率**：盈利交易占比

图表展示：
- 盈亏趋势图（最近30天）
- 月度盈亏柱状图
- 账户分布饼图
- 最近交易列表

### 投资工具

系统内置三个实用计算器：

1. **复利计算器**
   - 输入本金、年化收益率、投资年限
   - 计算最终金额和总收益

2. **仓位计算器**
   - 输入账户资金、风险比例、入场价、止损价
   - 计算建议仓位和最大亏损

3. **盈亏比计算器**
   - 输入入场价、止损价、目标价
   - 计算盈亏比和潜在收益/亏损百分比

---

## 交易管理

### 创建交易标的

在记录交易前，需要先创建交易标的：

1. 进入 **管理后台 → 交易标的**
2. 点击 **添加交易标的**
3. 填写信息：
   - **代码**：如 AAPL、600519、BTC
   - **名称**：如 苹果公司、贵州茅台
   - **类型**：股票、期货、外汇、加密货币、指数、期权
   - **合约乘数**：期货/指数填写，股票填1
   - **手续费设置**：费率或每手费用

### 记录交易

1. 进入 **管理后台 → 交易记录**
2. 点击 **添加交易记录**
3. 填写交易信息：
   - **账户**：选择交易账户
   - **标的**：选择交易标的
   - **方向**：买入/卖出
   - **数量**：交易数量
   - **价格**：下单价格
   - **成交价**：实际成交价（可选，默认等于下单价）
   - **状态**：待成交/已成交/已取消
   - **策略**：关联的交易策略（可选）

> **提示**：当状态设为"已成交"时，系统会自动计算手续费并同步持仓。

### 交易复盘

记录交易后的反思和总结：

1. 进入 **管理后台 → 交易复盘**
2. 关联对应的交易记录
3. 填写复盘内容：
   - 入场理由
   - 出场理由
   - 做对了什么
   - 做错了什么
   - 改进计划
   - 情绪状态评分

---

## 账户管理

### 创建账户

1. 进入 **管理后台 → 账户列表**
2. 点击 **添加账户**
3. 填写账户信息：
   - **名称**：如"A股主账户"
   - **类型**：股票、期货、外汇、加密货币、期权
   - **初始资金**：开户时的资金
   - **当前余额**：当前可用资金
   - **状态**：活跃/冻结/已关闭

### 账户流水

系统自动记录账户资金变动：
- 交易盈亏
- 手续费支出
- 入金/出金

查看路径：**管理后台 → 账户流水**

---

## 持仓管理

### 自动同步

当交易状态变为"已成交"时，系统自动：
1. 更新持仓数量
2. 计算新的持仓均价
3. 更新市值和浮动盈亏

### 手动管理

如需手动调整持仓：
1. 进入 **管理后台 → 持仓管理**
2. 可以手动修改持仓数量、均价等

### 重新同步持仓

如果持仓数据不准确，可以重新计算：

```bash
# 查看将要执行的操作（不实际执行）
python manage.py sync_positions --dry-run

# 重新计算所有持仓
python manage.py sync_positions --clear

# 仅同步指定账户
python manage.py sync_positions --account 1
```

---

## 策略管理

### 创建策略

1. 进入 **管理后台 → 策略列表**
2. 点击 **添加策略**
3. 填写策略信息：
   - 策略名称
   - 策略描述
   - 策略类型（趋势跟踪、均值回归、突破、套利等）
   - 状态（活跃/暂停/已停用）

### 策略绩效

系统自动统计每个策略的绩效指标：
- 总交易次数
- 盈利/亏损次数
- 胜率
- 总盈利/总亏损
- 盈亏比
- 平均盈利/平均亏损
- 最大单笔盈利/亏损

查看路径：**管理后台 → 策略绩效**

---

## 风险管理

### 风险规则

设置风险控制规则，触发时自动警告：

1. 进入 **管理后台 → 风险规则**
2. 创建规则：
   - **每日亏损限额**：当日亏损达到阈值时警告
   - **单笔亏损限额**：单笔交易亏损超限时警告
   - **连续亏损次数**：连续亏损N次时警告
   - **每日交易限制**：当日交易次数超限时警告
   - **最大回撤**：回撤超过阈值时警告
   - **最大仓位比例**：仓位占比超限时警告

### 风险警告

当触发风险规则时，系统会：
1. 创建风险警告记录
2. 发送通知提醒
3. 在仪表盘显示警告

查看路径：**管理后台 → 风险警告**

### 风险快照

系统每日记录风险状态快照：
- 当日盈亏
- 连续盈亏次数
- 当前回撤
- 最大回撤
- 风险评分

查看路径：**管理后台 → 风险快照**

---

## 报表分析

### 日报

系统自动生成每日交易报表：
- 期初/期末余额
- 当日盈亏
- 交易次数
- 胜率
- 手续费

查看路径：**管理后台 → 日报**

### 月报

系统自动生成月度汇总报表：
- 月初/月末余额
- 月度盈亏
- 月度交易次数
- 月度胜率
- 最大回撤

查看路径：**管理后台 → 月报**

### 深度分析

访问 **/analytics/** 页面，可进行多维度分析：

- **时间分析**：按小时、星期、月份分析交易表现
- **标的分析**：各标的盈亏统计
- **策略分析**：各策略绩效对比
- **方向分析**：多空方向盈亏对比
- **连续统计**：最大连胜/连亏
- **盈亏分布**：盈亏金额分布图

---

## 通知系统

### 通知中心

访问 **/notifications/** 页面管理通知：

**通知类型**：
- 价格提醒
- 计划提醒
- 风险警告
- 每日总结
- 交易执行
- 系统通知

**操作**：
- 标记已读/全部已读
- 删除通知
- 清理旧通知

### 价格提醒

设置价格提醒，当价格达到目标时通知：

1. 进入通知中心 → 价格提醒标签
2. 选择标的、条件（高于/低于/向上穿越/向下穿越）、目标价格
3. 点击创建

### 通知设置

自定义通知偏好：
- 开关各类通知
- 设置每日总结提醒时间
- 设置计划提前提醒时间
- 设置静默时段

---

## 自动化功能

### 自动计算

系统在交易保存时自动执行：

1. **手续费计算**：根据标的配置自动计算
2. **持仓同步**：自动更新持仓数量和均价
3. **账户余额更新**：自动更新账户余额
4. **日报更新**：自动更新当日报表
5. **风险检查**：自动检查风险规则

### 自动化管理页面

访问 **/automation/** 页面：

**状态概览**：
- 今日交易数
- 持仓数量
- 今日日报数
- 风险快照数
- 活跃警告数

**手动执行任务**：
- 生成日报
- 生成月报
- 更新风险快照
- 检查风险规则
- 更新策略绩效
- 过期交易计划
- 过期价格提醒

### 命令行工具

```bash
# 每日任务（生成日报、更新风险快照、检查风险规则等）
python manage.py run_daily_tasks

# 每月任务（生成月报）
python manage.py run_monthly_tasks

# 每小时任务（计划提醒、风险检查）
python manage.py run_hourly_tasks

# 同步持仓
python manage.py sync_positions

# 模拟运行（不实际执行）
python manage.py run_daily_tasks --dry-run
```

### 定时任务配置

使用 crontab 设置定时执行：

```bash
# 编辑 crontab
crontab -e

# 添加以下配置
# 每天凌晨1点运行每日任务
0 1 * * * cd /path/to/mytrader && .venv/bin/python manage.py run_daily_tasks

# 每月1日凌晨2点运行月度任务
0 2 1 * * cd /path/to/mytrader && .venv/bin/python manage.py run_monthly_tasks

# 每小时运行一次检查
0 * * * * cd /path/to/mytrader && .venv/bin/python manage.py run_hourly_tasks
```

---

## 数据导入导出

### 导出数据

访问 **/import-export/** 页面：

**可导出内容**：
- 交易记录（CSV）
- 账户数据（CSV）
- 持仓数据（CSV）
- 交易标的（CSV）
- 分析报告（CSV）

**筛选条件**：
- 选择账户
- 选择日期范围

### 导入数据

**导入交易记录**：
1. 下载导入模板
2. 按模板格式填写数据
3. 选择目标账户
4. 上传文件导入

**导入交易标的**：
1. 下载标的模板
2. 按模板格式填写
3. 上传文件导入

---

## 常见问题

### Q: 持仓数据不准确怎么办？

A: 运行持仓同步命令重新计算：
```bash
python manage.py sync_positions --clear
```

### Q: 如何批量导入历史交易？

A:
1. 下载交易导入模板
2. 按格式填写历史交易数据
3. 在导入导出页面上传文件
4. 运行持仓同步命令

### Q: 手续费没有自动计算？

A: 检查以下设置：
1. 交易标的是否配置了手续费率或每手费用
2. 交易状态是否为"已成交"
3. 手续费字段是否为0（只有为0时才会自动计算）

### Q: 日报没有自动生成？

A: 日报在以下情况生成：
1. 有已成交的交易时自动更新
2. 运行 `run_daily_tasks` 命令时生成昨天的日报
3. 在自动化页面手动点击"生成日报"

### Q: 如何备份数据？

A: 备份 SQLite 数据库文件：
```bash
cp db.sqlite3 db.sqlite3.backup
```

### Q: 如何重置密码？

A: 使用 Django 命令：
```bash
python manage.py changepassword <用户名>
```

---

## 技术支持

如有问题，请检查：
1. 服务器日志：查看终端输出
2. 浏览器控制台：F12 查看错误信息
3. Django 日志：查看 `logs/` 目录（如已配置）

---

*MyTrader 交易管理系统 © 2025*
